<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.625 -apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}h1{margin-left:0;margin-right:0;margin-top:2.4375rem;padding-bottom:calc(0.40625rem - 1px);padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.21875rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.1;border-bottom:1px solid hsla(0,0%,0%,0.07);border:0;margin:0;}h2{margin-left:0;margin-right:0;margin-top:1.625rem;padding-bottom:calc(0.40625rem - 1px);padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.40625rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;border-bottom:1px solid rgba(253, 214, 23, 0.5);}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;color:hsla(0,0%,0%,0.53);font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}ul{margin-left:1.625rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.625rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;font-size:0.85rem;line-height:1.625rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;font-size:1rem;line-height:1.625rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}blockquote{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:calc(0.8125rem - 1px);padding-right:0;padding-top:0;margin-bottom:0.8125rem;border-left:4px solid hsla(0,0%,0%,0.13);color:hsla(0,0%,0%,0.53);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(0.8125rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}b{font-weight:600;}strong{font-weight:600;}dt{font-weight:600;}th{font-weight:600;}li{margin-bottom:calc(0.8125rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.625rem;margin-bottom:calc(0.8125rem / 2);margin-top:calc(0.8125rem / 2);}li > ul{margin-left:1.625rem;margin-bottom:calc(0.8125rem / 2);margin-top:calc(0.8125rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(0.8125rem / 2);}code{font-size:0.85rem;line-height:1.625rem;}kbd{font-size:0.85rem;line-height:1.625rem;}samp{font-size:0.85rem;line-height:1.625rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.08333rem;padding-right:1.08333rem;padding-top:0.8125rem;padding-bottom:calc(0.8125rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}h3,h4,h5,h6{margin-bottom:0.8125rem;margin-top:1.625rem;}ol,ul{margin-left:2.03125rem;}li>ol,li>ul{margin-left:2.03125rem;}a{color:#FF00FF;text-decoration:none;}a:hover,a:active{text-decoration:underline;}</style><style data-href="/styles.a03ac9cc63f55f1507aa.css" id="gatsby-global-css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><meta name="generator" content="Gatsby 2.28.2"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=5c53dc1031075781fe637e715c3e316d" type="image/png"/><link rel="icon" href="/favicon.svg?v=5c53dc1031075781fe637e715c3e316d" type="image/svg+xml"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=5c53dc1031075781fe637e715c3e316d"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=5c53dc1031075781fe637e715c3e316d"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=5c53dc1031075781fe637e715c3e316d"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=5c53dc1031075781fe637e715c3e316d"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=5c53dc1031075781fe637e715c3e316d"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=5c53dc1031075781fe637e715c3e316d"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=5c53dc1031075781fe637e715c3e316d"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=5c53dc1031075781fe637e715c3e316d"/><title data-react-helmet="true">Authenticating your Node.js app with Google as an OpenId Connect Provider | NoSleep Javascript Blog</title><meta data-react-helmet="true" name="title" content="Authenticating your Node.js app with Google as an OpenId Connect Provider"/><meta data-react-helmet="true" name="description" content="Let&#x27;s build the basic boilerplate for OpenId Connect based authencation with Google as Identity provider, persistent session cookies, express middleware in Typescript and Node.js
By franleplant"/><meta data-react-helmet="true" property="og:title" content="Authenticating your Node.js app with Google as an OpenId Connect Provider"/><meta data-react-helmet="true" property="og:description" content="Let&#x27;s build the basic boilerplate for OpenId Connect based authencation with Google as Identity provider, persistent session cookies, express middleware in Typescript and Node.js
By franleplant"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="franleplant"/><meta data-react-helmet="true" name="twitter:title" content="Authenticating your Node.js app with Google as an OpenId Connect Provider"/><meta data-react-helmet="true" name="twitter:description" content="Let&#x27;s build the basic boilerplate for OpenId Connect based authencation with Google as Identity provider, persistent session cookies, express middleware in Typescript and Node.js
By franleplant"/><script data-react-helmet="true" id="mcjs">!function(c,h,i,m,p){m=c.createElement(h),p=c.getElementsByTagName(h)[0],m.async=1,m.src=i,p.parentNode.insertBefore(m,p)}(document,"script","https://chimpstatic.com/mcjs-connected/js/users/c388336980630bd93629517cb/79c014026202565af1500f561.js");
          </script><script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>            
              (adsbygoogle = window.adsbygoogle || []).push({
                google_ad_client: "ca-pub-2006751746052752",
                enable_page_level_ads: true
              });
          </script><link as="script" rel="preload" href="/webpack-runtime-04fbafd859ab94f12b33.js"/><link as="script" rel="preload" href="/styles-55e82d6ff5158c00b714.js"/><link as="script" rel="preload" href="/framework-741ade27086b2708e961.js"/><link as="script" rel="preload" href="/app-b1e139d0da4ec73b7381.js"/><link as="script" rel="preload" href="/201ad6c3f2c882b9d9cf079e4b183f9823aadb3d-8b06601edeb74dd5b1c5.js"/><link as="script" rel="preload" href="/07df214fa9a6bfa95f2aa0c4b93680dbfb4b3ad9-8b678077d6dbe8f052d8.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-tsx-13d8f6300d73de8b3055.js"/><link as="fetch" rel="preload" href="/page-data/openid-oauth-authentication-for-nodejs/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/63159454.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="1o0b8os">.css-1o0b8os{margin-left:auto;margin-right:auto;max-width:52rem;padding:1.625rem 1.21875rem;}</style><div class="css-1o0b8os edujns40"><style data-emotion-css="h0tuly">:not(pre) > code[class*="language-"]{word-break:break-word;}.code-block-title{margin-bottom:-0.6rem;padding:0.5em 1em;font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace;background-color:black;color:white;z-index:0;border-top-left-radius:0.3em;border-top-right-radius:0.3em;}button,input[type="submit"]{background-color:#FF00FF !important;border:0;}button,input[type=submit]:hover{background-color:#FF00FF !important;}button,input{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;padding:4px 10px;border:1px solid #ccc;outline:0 !important;border-radius:4px;box-sizing:boder-box;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}input:focus{border:1px solid #FF00FF !important;box-shadow:0px 0px 2px #FF00FFDE;}blockquote{margin-top:40px;margin-bottom:40px;border-left:6px solid #FDD617;background:rgba(253,214,23,0.1);padding-top:20px;padding-bottom:20px;color:rgba(0,0,0,0.8);}</style><header><style data-emotion-css="1151z2w">.css-1151z2w{margin:0;}.css-1151z2w img{max-width:25%;margin:0;}</style><h3 class="css-1151z2w e1k5ywqr0"><a href="/"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxOC4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB2aWV3Qm94PSIwIDAgOTYwIDQxMC44IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCA5NjAgNDEwLjgiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPGc+DQoJPGc+DQoJCTxnPg0KCQkJPHBhdGggZmlsbD0iIzAxMDIwMiIgZD0iTTQ0OS40LDI0OGgtMTcuM2wtMjUuNS00NC44VjI0OGgtMTcuNHYtNzJoMTcuNGwyNS41LDQ0LjhWMTc2aDE3LjNWMjQ4eiIvPg0KCQkJPHBhdGggZmlsbD0iIzAxMDIwMiIgZD0iTTUyMS40LDIxMy41YzAsNy0xLjMsMTMuMi0zLjksMTguN2MtMi42LDUuNC02LjMsOS42LTExLjEsMTIuNWMtNC44LDIuOS0xMC4zLDQuNC0xNi40LDQuNA0KCQkJCWMtNi4xLDAtMTEuNi0xLjQtMTYuMy00LjJjLTQuOC0yLjgtOC41LTYuOS0xMS4xLTEyLjFjLTIuNy01LjItNC0xMS4zLTQuMi0xOC4xdi00LjFjMC03LjEsMS4zLTEzLjMsMy45LTE4LjcNCgkJCQljMi42LTUuNCw2LjMtOS42LDExLjEtMTIuNWM0LjgtMi45LDEwLjMtNC40LDE2LjUtNC40YzYuMSwwLDExLjUsMS41LDE2LjMsNC40YzQuOCwyLjksOC41LDcsMTEuMiwxMi40YzIuNyw1LjQsNCwxMS41LDQsMTguNA0KCQkJCVYyMTMuNXogTTUwMy44LDIxMC40YzAtNy4yLTEuMi0xMi42LTMuNi0xNi4zYy0yLjQtMy43LTUuOC01LjYtMTAuMy01LjZjLTguNywwLTEzLjMsNi41LTEzLjgsMTkuNmwwLDUuMw0KCQkJCWMwLDcuMSwxLjIsMTIuNSwzLjUsMTYuM2MyLjMsMy44LDUuOCw1LjcsMTAuNCw1LjdjNC40LDAsNy44LTEuOSwxMC4xLTUuNnMzLjYtOS4xLDMuNi0xNi4xVjIxMC40eiIvPg0KCQkJPHBhdGggZmlsbD0iIzAxMDIwMiIgZD0iTTU2Ny41LDIyOC45YzAtMi41LTAuOS00LjUtMi43LTUuOWMtMS44LTEuNC01LTIuOS05LjUtNC40Yy00LjUtMS41LTguMi0zLTExLjEtNC40DQoJCQkJYy05LjMtNC42LTE0LTEwLjktMTQtMTguOWMwLTQsMS4yLTcuNSwzLjUtMTAuNmMyLjMtMy4xLDUuNi01LjQsOS45LTcuMWM0LjMtMS43LDktMi41LDE0LjMtMi41YzUuMiwwLDkuOCwwLjksMTMuOSwyLjgNCgkJCQljNC4xLDEuOCw3LjMsNC41LDkuNiw3LjljMi4zLDMuNCwzLjQsNy4zLDMuNCwxMS43aC0xNy4zYzAtMi45LTAuOS01LjItMi43LTYuOGMtMS44LTEuNi00LjItMi40LTcuMy0yLjQNCgkJCQljLTMuMSwwLTUuNiwwLjctNy4zLDIuMWMtMS44LDEuNC0yLjcsMy4xLTIuNyw1LjJjMCwxLjgsMSwzLjUsMyw1czUuNSwzLjEsMTAuNCw0LjdjNSwxLjYsOS4xLDMuMywxMi4zLDUuMg0KCQkJCWM3LjgsNC41LDExLjcsMTAuNywxMS43LDE4LjZjMCw2LjMtMi40LDExLjItNy4xLDE0LjhjLTQuOCwzLjYtMTEuMyw1LjQtMTkuNSw1LjRjLTUuOCwwLTExLjEtMS0xNS45LTMuMQ0KCQkJCWMtNC43LTIuMS04LjMtNS0xMC43LTguNmMtMi40LTMuNi0zLjYtNy44LTMuNi0xMi42aDE3LjRjMCwzLjksMSw2LjcsMyw4LjVjMiwxLjgsNS4yLDIuNyw5LjcsMi43YzIuOSwwLDUuMS0wLjYsNi44LTEuOQ0KCQkJCUM1NjYuNywyMzIuOCw1NjcuNSwyMzEuMSw1NjcuNSwyMjguOXoiLz4NCgkJCTxwYXRoIGZpbGw9IiMwMTAyMDIiIGQ9Ik02MTEuMiwyMzQuNmgzMC4yVjI0OGgtNDcuNnYtNzJoMTcuNFYyMzQuNnoiLz4NCgkJCTxwYXRoIGZpbGw9IiMwMTAyMDIiIGQ9Ik02OTMuNCwyMTcuNGgtMjcuM3YxNy4yaDMyLjNWMjQ4aC00OS42di03Mmg0OS43djEzLjRoLTMyLjR2MTUuMmgyNy4zVjIxNy40eiIvPg0KCQkJPHBhdGggZmlsbD0iIzAxMDIwMiIgZD0iTTc1MC4xLDIxNy40aC0yNy4zdjE3LjJoMzIuM1YyNDhoLTQ5LjZ2LTcyaDQ5Ljd2MTMuNGgtMzIuNHYxNS4yaDI3LjNWMjE3LjR6Ii8+DQoJCQk8cGF0aCBmaWxsPSIjMDEwMjAyIiBkPSJNNzc5LjUsMjIzLjZWMjQ4aC0xNy40di03MmgyOC44YzUuNSwwLDEwLjQsMSwxNC42LDNjNC4yLDIsNy41LDQuOSw5LjgsOC43YzIuMywzLjcsMy41LDgsMy41LDEyLjcNCgkJCQljMCw3LTIuNSwxMi42LTcuNSwxNi44Yy01LDQuMi0xMS45LDYuMy0yMC43LDYuM0g3NzkuNXogTTc3OS41LDIxMC4yaDExLjRjMy40LDAsNS45LTAuOCw3LjctMi41czIuNi00LjEsMi42LTcuMQ0KCQkJCWMwLTMuNC0wLjktNi4xLTIuNy04LjFjLTEuOC0yLTQuMy0zLTcuNC0zLjFoLTExLjZWMjEwLjJ6Ii8+DQoJCQk8cGF0aCBmaWxsPSIjMDEwMjAyIiBkPSJNMzk2LjEsMjcwaDkuN3Y1MS4yYzAsNi43LTIsMTItNi4xLDE2Yy00LjEsNC05LjQsNS45LTE1LjksNS45Yy02LjYsMC0xMS45LTEuOC0xNS44LTUuMw0KCQkJCWMtMy45LTMuNS01LjgtOC42LTUuNi0xNS4zbDAuMS0wLjNoOS40YzAsNC41LDEsNy44LDMuMSwxMGMyLjEsMi4yLDUsMy4zLDguOSwzLjNjMy42LDAsNi41LTEuMyw4LjgtMy45DQoJCQkJYzIuMy0yLjYsMy40LTYuMSwzLjQtMTAuNFYyNzB6Ii8+DQoJCQk8cGF0aCBmaWxsPSIjMDEwMjAyIiBkPSJNNDU4LjcsMzIzLjVoLTI3LjFsLTYuNCwxOC42aC05LjlsMjYtNzJoOC40bDI1LjQsNzJINDY1TDQ1OC43LDMyMy41eiBNNDM0LjQsMzE1LjNoMjEuNWwtMTAuNS0zMC45DQoJCQkJaC0wLjNMNDM0LjQsMzE1LjN6Ii8+DQoJCQk8cGF0aCBmaWxsPSIjMDEwMjAyIiBkPSJNNTAzLjEsMzIzLjFsMS42LDZoMC4zbDEuNi02bDE4LjYtNTMuMWgxMC41bC0yNi44LDcyaC04LjRsLTI2LjgtNzJoMTAuNkw1MDMuMSwzMjMuMXoiLz4NCgkJCTxwYXRoIGZpbGw9IiMwMTAyMDIiIGQ9Ik01NzguOCwzMjMuNWgtMjcuMWwtNi40LDE4LjZoLTkuOWwyNi03Mmg4LjRsMjUuNCw3MmgtOS45TDU3OC44LDMyMy41eiBNNTU0LjUsMzE1LjNoMjEuNWwtMTAuNS0zMC45DQoJCQkJaC0wLjNMNTU0LjUsMzE1LjN6Ii8+DQoJCQk8cGF0aCBmaWxsPSIjMDEwMjAyIiBkPSJNNjQ0LjEsMzIzLjljMC0zLjMtMS4yLTYtMy41LTguMmMtMi4zLTIuMi02LjUtNC4xLTEyLjQtNS42Yy03LjMtMS44LTEzLTQuNS0xNy4xLTgNCgkJCQljLTQuMS0zLjUtNi4yLTgtNi4yLTEzLjNjMC01LjYsMi4yLTEwLjMsNi42LTE0LjFzMTAuMi01LjYsMTcuMi01LjZjNy42LDAsMTMuNiwyLjIsMTguMSw2LjVjNC41LDQuMyw2LjcsOS4zLDYuNiwxNS4xbC0wLjEsMC4zDQoJCQkJSDY0NGMwLTQuMS0xLjQtNy41LTQuMy0xMC4xYy0yLjktMi43LTYuNS00LTExLTRjLTQuNiwwLTgsMS4xLTEwLjUsMy4zcy0zLjYsNS4xLTMuNiw4LjZjMCwzLjEsMS4zLDUuNyw0LDcuOA0KCQkJCWMyLjcsMi4xLDcsMy45LDEyLjksNS41YzcuMywxLjksMTIuOCw0LjcsMTYuNiw4LjNjMy44LDMuNyw1LjcsOC4yLDUuNywxMy42YzAsNS44LTIuMywxMC41LTYuOSwxNGMtNC42LDMuNS0xMC41LDUuMy0xNy45LDUuMw0KCQkJCWMtNywwLTEzLjEtMS45LTE4LjQtNS44Yy01LjMtMy45LTcuOS05LjEtNy43LTE1LjZsMC4xLTAuM2g5LjNjMCw0LjUsMS43LDgsNS4xLDEwLjVjMy40LDIuNSw3LjMsMy43LDExLjYsMy43DQoJCQkJYzQuNiwwLDguMy0xLDExLTMuMUM2NDIuOCwzMzAuMiw2NDQuMSwzMjcuNCw2NDQuMSwzMjMuOXoiLz4NCgkJCTxwYXRoIGZpbGw9IiMwMTAyMDIiIGQ9Ik03MTkuMSwzMTlsMC4xLDAuM2MwLjEsNi44LTIuMiwxMi40LTcuMSwxN2MtNC45LDQuNi0xMS4zLDYuOC0xOS4zLDYuOGMtOC4xLDAtMTQuOC0yLjktMTkuOS04LjcNCgkJCQljLTUuMS01LjgtNy43LTEzLjEtNy43LTIydi0xMi44YzAtOC45LDIuNi0xNi4yLDcuNy0yMmM1LjEtNS44LDExLjgtOC43LDE5LjktOC43YzguMSwwLDE0LjYsMi4yLDE5LjQsNi41DQoJCQkJYzQuOCw0LjMsNy4yLDEwLjEsNywxNy4ybC0wLjEsMC4zaC05LjRjMC01LTEuNS05LTQuNS0xMmMtMy0yLjktNy4yLTQuNC0xMi42LTQuNGMtNS40LDAtOS44LDIuMi0xMyw2LjYNCgkJCQljLTMuMiw0LjQtNC44LDkuOC00LjgsMTYuM3YxMi45YzAsNi42LDEuNiwxMiw0LjgsMTYuNGMzLjIsNC40LDcuNiw2LjYsMTMsNi42YzUuNCwwLDkuNi0xLjUsMTIuNi00LjRjMy0yLjksNC41LTcsNC41LTEyLjENCgkJCQlINzE5LjF6Ii8+DQoJCQk8cGF0aCBmaWxsPSIjMDEwMjAyIiBkPSJNNzQxLjYsMzEwLjhWMzQyaC05Ljd2LTcyaDI0LjZjNy45LDAsMTMuOSwxLjcsMTguMSw1LjJjNC4yLDMuNSw2LjIsOC42LDYuMiwxNS4yYzAsMy43LTEsNi45LTIuOSw5LjYNCgkJCQljLTEuOSwyLjctNC43LDQuOS04LjQsNi41YzQsMS4zLDYuOCwzLjQsOC41LDYuM2MxLjcsMi45LDIuNiw2LjUsMi42LDEwLjd2Ni44YzAsMi4yLDAuMiw0LjMsMC43LDZjMC41LDEuOCwxLjQsMy4yLDIuNiw0LjR2MS4yDQoJCQkJaC0xMGMtMS4zLTEuMS0yLjEtMi44LTIuNS00LjljLTAuNC0yLjItMC41LTQuNC0wLjUtNi43di02LjZjMC0zLjktMS4xLTctMy40LTkuNHMtNS4zLTMuNi05LjItMy42SDc0MS42eiBNNzQxLjYsMzAzLjFoMTMuOQ0KCQkJCWM1LjUsMCw5LjUtMSwxMS45LTMuMXMzLjYtNS4zLDMuNi05LjZjMC00LjEtMS4yLTcuMi0zLjUtOS40Yy0yLjQtMi4yLTYtMy4zLTExLTMuM2gtMTQuOVYzMDMuMXoiLz4NCgkJCTxwYXRoIGZpbGw9IiMwMTAyMDIiIGQ9Ik04MDcuMSwzNDJoLTkuOHYtNzJoOS44VjM0MnoiLz4NCgkJCTxwYXRoIGZpbGw9IiMwMTAyMDIiIGQ9Ik04MzQuNywzMTMuMVYzNDJIODI1di03MmgyNy42YzcuNywwLDEzLjcsMiwxNy45LDUuOWM0LjMsNCw2LjQsOS4yLDYuNCwxNS42YzAsNi41LTIuMSwxMS44LTYuNCwxNS43DQoJCQkJYy00LjMsMy45LTEwLjMsNS45LTE3LjksNS45SDgzNC43eiBNODM0LjcsMzA1LjVoMTcuOGM0LjksMCw4LjUtMS4zLDEwLjktMy45YzIuNC0yLjYsMy42LTUuOSwzLjYtOS45cy0xLjItNy4zLTMuNi0xMA0KCQkJCXMtNi4xLTQtMTAuOS00aC0xNy44VjMwNS41eiIvPg0KCQkJPHBhdGggZmlsbD0iIzAxMDIwMiIgZD0iTTkzOS44LDI3Ny42SDkxNlYzNDJoLTkuN3YtNjQuNGgtMjMuNVYyNzBoNTdWMjc3LjZ6Ii8+DQoJCTwvZz4NCgk8L2c+DQoJPGc+DQoJCTxwYXRoIGZpbGw9IiMwMTAyMDIiIGQ9Ik0xMDIuNSwxNDQuN0wyNy43LDcwYy0zLjMsMy4yLTYuNiw2LjQtOS44LDkuOGw3NC43LDc0LjdDOTUuOCwxNTEuMSw5OS4xLDE0Ny44LDEwMi41LDE0NC43eiIvPg0KCQk8cGF0aCBmaWxsPSIjMDEwMjAyIiBkPSJNMTA3LjYsMTguM2MtNC4zLDEuNy04LjUsMy42LTEyLjYsNS42bDQyLjUsOTYuOWM0LjEtMiw4LjMtMy45LDEyLjYtNS41TDEwNy42LDE4LjN6Ii8+DQoJPC9nPg0KCTxjaXJjbGUgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDEwMjAyIiBzdHJva2Utd2lkdGg9IjEzLjc5NDQiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgY3g9IjIwNC43IiBjeT0iMjU2LjciIHI9IjEyMi40Ii8+DQoJPGc+DQoJCTxwYXRoIGZpbGw9IiNGRkQ3MDMiIGQ9Ik0yNzMuNSwxOTcuN2MtMy4yLDQuNC04LjQsNy40LTE0LjMsNy40Yy05LjcsMC0xNy42LTcuOS0xNy42LTE3LjZjMC00LjQsMS42LTguNCw0LjMtMTEuNQ0KCQkJYy0xMi4zLTYuMy0yNi4zLTkuOS00MS4xLTkuOWMtNTAsMC05MC42LDQwLjYtOTAuNiw5MC42czQwLjYsOTAuNiw5MC42LDkwLjZzOTAuNi00MC42LDkwLjYtOTAuNg0KCQkJQzI5NS4zLDIzNC4yLDI4Ny4xLDIxMy42LDI3My41LDE5Ny43eiBNMjA0LjcsMjkyLjdjLTE5LjksMC0zNi0xNi4xLTM2LTM2YzAtMTkuOSwxNi4xLTM2LDM2LTM2czM2LDE2LjEsMzYsMzYNCgkJCVMyMjQuNiwyOTIuNywyMDQuNywyOTIuN3oiLz4NCgk8L2c+DQoJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDEwMjAyIiBzdHJva2Utd2lkdGg9IjExLjAzNTUiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTIwNC43LDI1Ni43Ii8+DQo8L2c+DQo8L3N2Zz4NCg==" alt="NoSleep Javascript"/></a></h3></header><main><article><header><style data-emotion-css="ykg09r">.css-ykg09r{margin-top:1.625rem;margin-bottom:0;}</style><h1 class="css-ykg09r">Authenticating your Node.js app with Google as an OpenId Connect Provider</h1><style data-emotion-css="1jp1cwv">.css-1jp1cwv{display:block;margin-bottom:1.625rem;}</style><div style="font-size:0.87055rem;line-height:1.625rem" class="css-1jp1cwv">October 23, 2020 • 19 min read<style data-emotion-css="p445hl">.css-p445hl{margin-top:10px;margin-left:-5px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}</style><div class="css-p445hl e17mrjfc0"><style data-emotion-css="9dqtmz">.css-9dqtmz{box-sizing:border-box;margin:0;margin-top:5px;padding:0;color:black;line-height:1.5;display:inline-block;height:auto;margin-right:8px;padding:0 7px;font-size:12px;line-height:20px;white-space:nowrap;background:rgba(253,214,23,0.05);border:1px solid #FDD617;border-radius:4px;cursor:pointer;}.css-9dqtmz:hover{background:rgba(253,214,23,0.5);}</style><span class="css-9dqtmz e17mrjfc1">#TypeScript</span><span class="css-9dqtmz e17mrjfc1">#Javascript</span><span class="css-9dqtmz e17mrjfc1">#Nodejs</span><span class="css-9dqtmz e17mrjfc1">#express</span><span class="css-9dqtmz e17mrjfc1">#OpenId Connect</span><span class="css-9dqtmz e17mrjfc1">#oidc</span><span class="css-9dqtmz e17mrjfc1">#OAuth 2.0</span><span class="css-9dqtmz e17mrjfc1">#middleware</span><span class="css-9dqtmz e17mrjfc1">#Single Sign On</span><span class="css-9dqtmz e17mrjfc1">#microservice</span></div></div></header><section><h2 id="table-of-contents"><a href="#table-of-contents" aria-label="table of contents permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Table of Contents</h2>
<div class="toc">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#so-what-is-openid-connect">So what is OpenId Connect?</a></li>
<li><a href="#thats-fine-but-why-should-i-care">That’s fine, but why should I care?</a></li>
<li>
<p><a href="#show-me-the-code">Show me the code!</a></p>
<ul>
<li><a href="#a-note-on-tooling">A note on tooling</a></li>
<li><a href="#step-1-what-are-we-building">Step 1: What are we building?</a></li>
<li><a href="#step-2-initializing">Step 2: Initializing</a></li>
<li><a href="#step-3-log-in">Step 3: Log In</a></li>
<li><a href="#step-4-persistent-session">Step 4: Persistent Session</a></li>
<li><a href="#step-5-log-out">Step 5: Log Out</a></li>
<li><a href="#step-6-putting-it-all-together">Step 6: Putting it all together</a></li>
<li><a href="#step-7-single-sign-on">Step 7: Single Sign On</a></li>
</ul>
</li>
<li><a href="#bonus-the-complete-sequence-diagram-of-oidc-authentication">Bonus: the complete sequence diagram of oidc authentication</a></li>
<li><a href="#bonus-what-are-the-access-refresh-and-id-tokens">Bonus: what are the access, refresh and id tokens?</a></li>
<li><a href="#exercise-1">Exercise 1</a></li>
<li><a href="#closing">Closing</a></li>
</ul>
</div>
<h2 id="introduction"><a href="#introduction" aria-label="introduction permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction</h2>
<p>Let’s build the basic boilerplate for an OpenId Connect based Authentication mechanism
for our Node.js / Typescript app that supports SSO (Single Sign On experience) out of the box
and that will fit very well with a microservice architecture with no statefulness added.</p>
<p>This sort of setup is great for microservice architectures because</p>
<ul>
<li>it provides clear authentication (and authorization) interfaces based on industries best practices</li>
<li>it works well with self contained auth tokens that can be used for communications across microservices</li>
<li>it requires no extra stateful layers (such as session databases)</li>
<li>it can be easily expanded to make up a Single Sign on experience across multiple apps and even across companies.</li>
</ul>
<h2 id="so-what-is-openid-connect"><a href="#so-what-is-openid-connect" aria-label="so what is openid connect permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>So what is OpenId Connect?</h2>
<blockquote>
<p>OpenId Connect (a.k.a oidc) is an <em>interoperable authentication protocol</em> based on the OAuth 2.0 family of specifications.</p>
<p><a href="https://openid.net/connect/faq/">src</a></p>
</blockquote>
<p>The line between OpenId and OAuth is blurry in practice and in learning material in the web the concepts
are sometimes a mix and match of both.</p>
<p>I like to think of OpenId and OAuth as a set of specifications that
define standard APIs for Authentication and Authorization, respectively.</p>
<blockquote>
<p>OpenID Connect lets developers authenticate their users across websites and
apps without having to own and manage password files. For the app builder,
it provides a secure verifiable, answer to the question:
“What is the identity of the person currently using the browser or native app that is connected to me?”</p>
<p><a href="https://openid.net/connect/faq/">src</a></p>
</blockquote>
<p>This has enabled 3rd party Authentication providers and the always present “Log In with X”
you see around the web, such Auth providers include Google (the one we use in the example code),
Auth0, Microsoft, Okta, among many others. <a href="https://openid.net/certification/">See certified providers here</a></p>
<p>Additionally, OpenId Connect can be used in enterprise settings like shared Auth and Identity provider
across many apps (think about Microsoft active directory, or Okta’s service)
providing a Single Sign On experience; and also as a way of structuring a microservice
architecture with multiple “clients” (OAuth lingo for applications that interact with the Auth Server).</p>
<p>If you want to go down the rabbit hole and learn more check these resources out</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=996OiexHze0">Nate Barbettini’s OAuth and OpenId in plain English</a></li>
<li><a href="https://developer.okta.com/blog/2019/10/21/illustrated-guide-to-oauth-and-oidc">Okta’s Ilustrated Guide to Oauth and OpenId Connect</a></li>
<li><a href="https://tools.ietf.org/html/rfc6749">IEEE OAuth 2.0 RFC</a> (it is dense but has all the details)</li>
</ul>
<p>Here is a nice illustration of one of the most common ways of Authenticating with
OAuth 2.0 and OpenId Connect: the authorization code flow</p>
<p><img src="/46184ddba11a21c92840104b5eab19a9/flow1.svg" alt="OAuth OpenId high level flow diagram"></p>
<blockquote>
<p>Source: heavily inspired by this <a href="https://www.youtube.com/watch?v=996OiexHze0">Nate Barbettini’s presentation</a></p>
</blockquote>
<h2 id="thats-fine-but-why-should-i-care"><a href="#thats-fine-but-why-should-i-care" aria-label="thats fine but why should i care permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>That’s fine, but why should I care?</h2>
<p>OAuth 2.0 and oidc have become ever present in the modern application development landscape and
although the tooling is really good and hides a lot of details chances are that you will still require
a decent high level understanding of what you are doing.</p>
<p>This applies both to already existing applications and to the practice of designing and creating new
applications with modern architectures such as microservice oriented one.</p>
<p>I will try to find the sweet spot between comprehensive and high level coverage, let’s hope
I can achieve it.</p>
<h2 id="show-me-the-code"><a href="#show-me-the-code" aria-label="show me the code permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Show me the code!</h2>
<p>Let’s build a simple application that uses OAuth 2.0 and oidc. The idea is to show</p>
<ul>
<li>how to use 3rd party Auth and Identity providers</li>
<li>how to integrate those mechanisms with something familiar to the web platform: session cookies!</li>
<li>how to easily manage sessions in the Request-Response web app cycle (no libs here!)</li>
<li>how the session can be structured to be self contained for a stateless session management</li>
<li>security implications</li>
<li>how this application can be used to achieve SSO (single sign on experience across multiple apps)</li>
</ul>
<p>You can check the full code <a href="https://github.com/franleplant/sso-with-openid">here</a>.</p>
<h3 id="a-note-on-tooling"><a href="#a-note-on-tooling" aria-label="a note on tooling permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A note on tooling</h3>
<p>I have found a nice certified NodeJs library called <a href="https://github.com/panva/node-openid-client">openid-client</a>, it is a nice library with
decent Typescript support that makes it very easy to integrate Identity providers.</p>
<p>Another really cool thing about OpenId Connect is the concept of <a href="https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderMetadata">Discovery</a> which
basically means that although there are a bunch of parameters involved in setting up a proper
oidc flow like multiple urls, encryption algorithms, public keys to verify tokens, etc;
you really just need to use one url and, if the client library you are using supports it, the client will
use this Discovery mechanism to look for a <a href="https://developers.google.com/identity/protocols/oauth2/openid-connect#discovery">Discovery Document</a> that contains all the necessary parameters
and you are good to go!. <code class="language-text">openid-client</code> supports this!.</p>
<h3 id="step-1-what-are-we-building"><a href="#step-1-what-are-we-building" aria-label="step 1 what are we building permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 1: What are we building?</h3>
<p>We are going to use a top-down approach, so first we are going to cover how the app
works at the business logic level and in later steps we are going to cover
the “lib” side of things where we implement the proper express middleware, session management,
cookie storage, etc.</p>
<p>The app is really simple, it has two content routes</p>
<ul>
<li><code class="language-text">/</code> or the home where we show the “login” button and it is public.</li>
<li><code class="language-text">/private</code> were we display some information about the currently logged in user. If there is no user logged in we simply display an error.</li>
</ul>
<p>Here are some pictures:</p>
<style>
.screen-img img {
  border: 3px solid #CCC;
}
</style>
<div class="screen-img">
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/a206f12438f888385b39a4f2b0273f22/91f10/screen1.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 36.486486486486484%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABKklEQVQoz62MuU4CARRF5ztcABmUfQmDbMIoRhAU2RyEgFBoYaHW8onW2pkYE2NjgTiLGg3hOIwxwVa9Lyc59xVXaET9VHJufLKLYEgiK2+yXSyTL+xQKu0RT6wRlRJIsSSJZIZ4PI3HG0Bc9mB3iNjsTubmbSwsOnAsuRAiwQjBQBCPP4C0miJmkkrLZLIb5njOGgtHJLy+EP5ABJ8/jFNcQXS5cZmjobCEvJ4jmUib3YvQ7vZotjrsK2063T61uoLSbJneo3vYN/8HVKp1tvJF8lMKX+yWK1RrDY6OTxhcDDg/PTO7gnBzdc/15S0Pd48YLzq6pqNZaKiqZrmu6xiG8YPpb4qqqgyHT4xGz1YXPt7GvL+OmYz5lwjfMpne5O8Is8UanvHf5BPTW6Gf7tnuTQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Initial public screen with login link"
        title="Initial public screen with login link"
        src="/static/a206f12438f888385b39a4f2b0273f22/fcda8/screen1.png"
        srcset="/static/a206f12438f888385b39a4f2b0273f22/12f09/screen1.png 148w,
/static/a206f12438f888385b39a4f2b0273f22/e4a3f/screen1.png 295w,
/static/a206f12438f888385b39a4f2b0273f22/fcda8/screen1.png 590w,
/static/a206f12438f888385b39a4f2b0273f22/efc66/screen1.png 885w,
/static/a206f12438f888385b39a4f2b0273f22/91f10/screen1.png 992w"
        sizes="(max-width: 590px) 100vw, 590px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/9613b16e4e1c9d8bcd95bda6862bff04/0f7d5/screen2.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 108.1081081081081%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAABYlAAAWJQFJUiTwAAADmUlEQVQ4y51UW28TVxBe9b3/AMolJCGQVAaC4hAnhCTGCXG5PICEeERQwZ/hAbX9A5UQCPGCECAkaLkIqVKgSZ044ZbYayf4st712rve9e6ej5njGFaGgsSRvp1zZs6ZM/vNmVESfXuQmOpG18EdmE0cw8lTpzF2eBKjYxM4mpjFxGQCk1MJxEbHcWAwisGDw+jdvRe7undj2/Yu/LRtJ7Zs3S7Ba2X/QASRyAD6BvoxQQfHJ+KIDscwFB3B+JEpHBoZwxg5H4rGsP/AECL7BtHd04edXT3o2tWL/p/30UVD0tbTuxfKseRJxI/OYmbmOJK/nMJI7DCm4glMT88iHp8mfRLJ5AnaM0PRxqV9+NAoRRqVl50+cxYXf72MCxcvyb9R3q6ksZReJpBcSkuZSi3i9Zs3yOXyhJyEqrbQXrdtWVVFJpOR4LXiCx+O20Sj0UDDceAQavU6mp6H7xmKEOJrdhGSQRh0LqDBH4Rky2EYPDyKTtd1WJaFer0ubNsGw7JaknRwXbd1U0dEX3TIv888Lq+siIWF/5hbd3FxqfDv/HwxlUoV5+bmChqNtj/RGvK80qFk4jzTNL1CoeBREpz19XUYhvFEoUG2HzfxA2GQ9tthh2EOxWb4UtlsNuVvMWq1OifqBakjxNEo7YmRZGfnCI0w1x8jDHwfTdcxaH6NlNdJMm4Q/iS8bG/m+zrpIU5F1TRhE02sYod+LrOK548fvvjr0WNeK7YHxaGEefLC4MJmAJwF/xMES5kwokg4TitYxfUhDNNCUauW7Sau1hz8XnfwG+EPml+xXPHMdgMQAoLohEOssw+XpNOkCPL0o69UU6QzOhjzr97j5XIeqbdFLLx+j/RaBXkdQq0EyH0BqvYJvFZ0C6JouNjQGmJDs71csSaRL9WlJH2g1QKUa77QQgitUTZZBtAtyZH4VjX9b7V02KRQ5EOm+jWMKipUHaZZg6ZV5Jyh6wbbhFGtolo1W/sqOkplrT0XxVJJZlkmhT9V2vzu3Soy2SzWNzawRp1jdY06SFYVWTXnr2WySC0unb93/8HWJ0+f9T989PeeGzdvddMbXeG3SueDdilKhz69Q67fsNycC5IM3vYP4TbhHuEu4Q7B/Oxhf6PbfOQx/JjDZ8LNoV0psoNQvfIDlZIpYB23o9AZblk+dSCf9D6VI8+ljZqJaIQ55HotFIqS7HK5jBKRzLrOiFjypUyBIxNpSF27pfH4AHzPCK/CFbQLAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Authenticating with the oidc provider"
        title="Authenticating with the oidc provider"
        src="/static/9613b16e4e1c9d8bcd95bda6862bff04/fcda8/screen2.png"
        srcset="/static/9613b16e4e1c9d8bcd95bda6862bff04/12f09/screen2.png 148w,
/static/9613b16e4e1c9d8bcd95bda6862bff04/e4a3f/screen2.png 295w,
/static/9613b16e4e1c9d8bcd95bda6862bff04/fcda8/screen2.png 590w,
/static/9613b16e4e1c9d8bcd95bda6862bff04/efc66/screen2.png 885w,
/static/9613b16e4e1c9d8bcd95bda6862bff04/0f7d5/screen2.png 993w"
        sizes="(max-width: 590px) 100vw, 590px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/38ecb057c330665f2189718f37b62f20/0f7d5/screen3.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 59.45945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACFklEQVQoz52SUW/SUBTH+z00wgZsbJbSbcBGGYUBgwi4kUicMdmbD+rLfPFTTBOM0fgJFt7wS5gMBpEtxsQnlwwpBSMJECi03L+3pSwZziV6kl/PPeee/P+37WWii07Ew3Y41m1wcx4ExQjiiSSisQTuJe8jkUhhK7INfsUL33oAHq8fziUWdocTFqsNdyzzuHXbQrHCSmuGZ3lwHIsllwteX4AiwC+ICGyGIIYiEAIiFRLg4lbh5j1YvsvBOmfH3LwDNvsiWG4FghDExoYAx8IymJ1MFslUhqTTGTzI7hF6GjUWS6ip9A5lVxVDW2pQDBtZCARVnl/TVtd8xO/fRDgcJY8e7+Pg4AWeP32G7XgSTLVaRbFYxOnZGTk+LuLkpIxKpYJSqYRyuYJ6vY5WqwVZbqLZpJhrWZZJQ5YhSRIuajXUaj+g10y73dY3xz/pYKfTOVdV9XW/388pipIbDoc5AFPeUA4pRxSCSUzzZTC6uyQ1tEbTEPxEewsUlwlLRdnBYMBSAzc1slHDh+NJgELMfAmjq37/9hVH714ROjyxJeQK095M/NEwTqg/OvIFKRy+RLfX04c06qRRAU1fz2bKmJjq5BoXQ/DD+7dkN51EofCRmM7EnL9Sz3D9N/xy+hlP9vfolckin89j2BtDOv+FkaL+7VVvDKbT7Rq/vik3oAwVDHojtOUe1JH2f4I3bf6rmB6/Afy4DGIZyTJHAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Back to our private route in our app"
        title="Back to our private route in our app"
        src="/static/38ecb057c330665f2189718f37b62f20/fcda8/screen3.png"
        srcset="/static/38ecb057c330665f2189718f37b62f20/12f09/screen3.png 148w,
/static/38ecb057c330665f2189718f37b62f20/e4a3f/screen3.png 295w,
/static/38ecb057c330665f2189718f37b62f20/fcda8/screen3.png 590w,
/static/38ecb057c330665f2189718f37b62f20/efc66/screen3.png 885w,
/static/38ecb057c330665f2189718f37b62f20/0f7d5/screen3.png 993w"
        sizes="(max-width: 590px) 100vw, 590px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
</div>
<p>There are at least two additional routes that have to do with the OAuth flow
that we will cover later.</p>
<p>This is the <code class="language-text">index.ts</code> that makes up the high level app implementation, think of this
as a mix of the boilerplate plus the two domain / business specific routes.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Necessary for express to parse the cookies into a nice</span>
<span class="token comment">// higher level object</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// initialises the Issuer and the Client</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>auth<span class="token punctuation">.</span>initialize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Deals with the user session</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>auth<span class="token punctuation">.</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Adds the OAuth / OpenId necessary routes.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>auth<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// use the pre configured view engine</span>
  <span class="token comment">// to render the index.mustache file</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">"index"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/private"</span><span class="token punctuation">,</span> auth<span class="token punctuation">.</span>requireAuth<span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// This is the main high level hook for the user</span>
  <span class="token comment">// session, we will be building this later</span>
  <span class="token keyword">const</span> claims <span class="token operator">=</span> req<span class="token punctuation">.</span>session<span class="token operator">!</span><span class="token punctuation">.</span>tokenSet<span class="token punctuation">.</span><span class="token function">claims</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// render private.mustache and interpolate</span>
  <span class="token comment">// the following data</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">"private"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    email<span class="token operator">:</span> claims<span class="token punctuation">.</span>email<span class="token punctuation">,</span>
    picture<span class="token operator">:</span> claims<span class="token punctuation">.</span>picture<span class="token punctuation">,</span>
    name<span class="token operator">:</span> claims<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Express started on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Next we will cover more details (descending into the details).</p>
<h3 id="step-2-initializing"><a href="#step-2-initializing" aria-label="step 2 initializing permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 2: Initializing</h3>
<p>First we need to initialize the <a href="https://github.com/panva/node-openid-client">openid-client</a>
Issuer (the one that discovers all the publicly available OpenId configuration) and later the Client
(the one that we will use to make all the underlying HTTP calls).
We will abstract this step into a middleware and save the instances into the <code class="language-text">req.app</code> object
since these things need to be instantiated once per app.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">initialize</span><span class="token punctuation">(</span>
  req<span class="token operator">:</span> Request<span class="token punctuation">,</span>
  res<span class="token operator">:</span> Response<span class="token punctuation">,</span>
  next<span class="token operator">:</span> NextFunction
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>app<span class="token punctuation">.</span>authIssuer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> googleIssuer <span class="token operator">=</span> <span class="token keyword">await</span> Issuer<span class="token punctuation">.</span><span class="token function">discover</span><span class="token punctuation">(</span>
    <span class="token string">"https://accounts.google.com"</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">googleIssuer</span><span class="token punctuation">.</span><span class="token function">Client</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    client_id<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">OAUTH_CLIENT_ID</span><span class="token operator">!</span><span class="token punctuation">,</span>
    client_secret<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">OAUTH_CLIENT_SECRET</span><span class="token operator">!</span><span class="token punctuation">,</span>
    redirect_uris<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">getDomain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/auth/callback</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    response_types<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"code"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  req<span class="token punctuation">.</span>app<span class="token punctuation">.</span>authIssuer <span class="token operator">=</span> googleIssuer<span class="token punctuation">;</span>
  req<span class="token punctuation">.</span>app<span class="token punctuation">.</span>authClient <span class="token operator">=</span> client<span class="token punctuation">;</span>

  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Note: <code class="language-text">getDomain</code> is a thin helper that returns exactly this <code class="language-text">http://${process.env.HOST}:${process.env.PORT}</code>.</p>
<h3 id="step-3-log-in"><a href="#step-3-log-in" aria-label="step 3 log in permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 3: Log In</h3>
<p>We have a nice comprehensive sequence diagram of the all the HTTP redirects and
interactions that make up the complete OAuth / OpenId Connect authorization code flow
below in a <a href="#bonus-the-complete-sequence-diagram-of-oidc-authentication">bonus section</a></p>
<p>In this step we are going to build the two endpoints necessary for this type of auth flow:</p>
<ol>
<li>Auth entry point: Create a route that redirects to the right oidc provider authentication page and that kicks starts the whole auth flow, in our case we simply called it: <code class="language-text">/auth/login</code> but you can use whatever you like.</li>
<li>Callback: Create a route that the oidc provider will redirect back from the auth page with the auth code that we will later exchange for the proper access, id and refresh tokens. In our case we simply called it <code class="language-text">/auth/callback</code> but again it can be whatever you want it to be.</li>
</ol>
<p>We also encapsulated these routes into a nice middleware that we called <code class="language-text">auth.routes</code>.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Auth entry point.</span>
router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/auth/login"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Check the full code to see a</span>
  <span class="token comment">// concrete implementation of this</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">calcState</span><span class="token punctuation">(</span>extraContent<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// calculate the url where we want to redirect to</span>
  <span class="token keyword">const</span> authUrl <span class="token operator">=</span> req<span class="token punctuation">.</span>app<span class="token punctuation">.</span>authClient<span class="token punctuation">.</span><span class="token function">authorizationUrl</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    scope<span class="token operator">:</span> <span class="token string">"openid email profile"</span><span class="token punctuation">,</span>
    state<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">setAuthStateCookie</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span>authUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Callback</span>
router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/auth/callback"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> client <span class="token operator">=</span> req<span class="token punctuation">.</span>app<span class="token punctuation">.</span>authClient<span class="token punctuation">;</span>

  <span class="token comment">// extract all the necessary query params</span>
  <span class="token comment">// like the authorization code.</span>
  <span class="token keyword">const</span> params <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">callbackParams</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// read the state cookie</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">getAuthStateCookie</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// exchange the authorization code for the access,</span>
  <span class="token comment">// refresh and id token, this is what makes up the</span>
  <span class="token comment">// main `Back channel` communication, it is considered</span>
  <span class="token comment">// more secure and will include client_id and client_secret.</span>
  <span class="token keyword">const</span> tokenSet <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">getDomain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/auth/callback</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    params<span class="token punctuation">,</span>
    <span class="token comment">// The lib will compare the state that the</span>
    <span class="token comment">// identity provider passes as params</span>
    <span class="token comment">// with the one we stored in the cookies.</span>
    <span class="token punctuation">{</span> state <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// We can fetch the userinfo (basic identity attributes)</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">userinfo</span><span class="token punctuation">(</span>tokenSet<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Set the session cookie,</span>
  <span class="token comment">// we could also set req.session but</span>
  <span class="token comment">// since we are returning immediately is not</span>
  <span class="token comment">// a must</span>
  <span class="token keyword">const</span> sessionCookie <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">{</span> tokenSet<span class="token punctuation">,</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setSessionCookie</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> sessionCookie<span class="token punctuation">)</span><span class="token punctuation">;</span>

  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Notes:</p>
<ul>
<li>check the <a href="https://github.com/franleplant/sso-with-openid">complete code</a> to see how to implement logout and a back-to-original-route mechanism</li>
</ul>
<p>As you can see the <em>Auth entry point</em> is a very simple sync redirect to the Identity provider’s login,
the library is doing a lot of the work for us but the <code class="language-text">authUrl</code> will contain the <code class="language-text">client_id</code>,
the callback url <code class="language-text">http://host:port/auth/callback</code> in our case, required <code class="language-text">scopes</code>, etc.
This is also what we call the “Front channel” and it is considered not entirely secure, that is why
we are not sending the client secret at this stage, remember that this happens all in the browser via
HTTP redirects.</p>
<p>The <em>Callback</em> will be redirected from a successful login with the Identity provider and
will exchange the authorization code for the tokens (check inline comments).
This is the step where we more commonly deal with persistent sessions, notice that
the Identity Provider doesn’t deal with this and that’s something we need to deal with ourselves.</p>
<p>Check the <code class="language-text">state</code> parameter, this acts as a sort of <a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery">XSRF a.k.a. CSRF a.k.a. csurf</a> token that we can use to
prevent XSRF attacks but also to store <em>state</em> across the OAuth flow. See exercise at the bottom for more info.
Check the <a href="https://github.com/franleplant/sso-with-openid">full code</a> for a concrete but very simple working implementation.</p>
<p>We are going to use a very simple self contained stateless strategy here, we will cover it in more details
in the next section but at a high level what we are doing is setting a persistent cookie (the session cookie)
that will travel in all requests from the browser to our local server and that we will use to identify
users that already identified themselves.</p>
<h3 id="step-4-persistent-session"><a href="#step-4-persistent-session" aria-label="step 4 persistent session permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 4: Persistent Session</h3>
<p>There are several ways of handling sessions but in most cases
it all boils down to persisting a session across requests and
identifying requests with one or zero sessions, meaning, identifying the
already authenticated and identified users that are making requests to our app or simply
acknowledging that there is no previously authenticated user.</p>
<p>Sessions are most commonly persisted in the form of a long lived cookie in the browsers and
their content might be a session id that is mapped to the session object in a database
server side which is the stateful solution; or the content might be the entire self contained session object,
which is the stateless solution, this is a simpler approach that will work for us
and that has its merits in the microservice architecture.</p>
<blockquote>
<p>Why do we care about stateless vs stateful? Having a self contained cookie means that we can
know certain facts about the authenticated users without having to either interact with a database
or another service. Stateless is desired as much as possible because it is easy to horizontally scale
i.e. adding more instances of the app running in other nodes in our cluster, whereas scaling stateful
services is another whole challenge (think about master slave relationship between databases,
replication, backup, consistency considerations, etc).
The typical solution for a stateful session is to store a simple session id in the browser and then associate
that id in a key value database such as <a href="https://redis.io/">redis</a></p>
</blockquote>
<p><strong>When do we write the session cookie?</strong></p>
<p>We write it at two main steps:</p>
<ul>
<li>after login in</li>
<li>after refreshing the auth tokens (not necessary in a stateful session schema)</li>
</ul>
<p>We also clear it in two main steps:</p>
<ul>
<li>after logout</li>
<li>after trying to refresh a token and the refresh token has expired.</li>
</ul>
<p><strong>And when do we read the session cookie? And what do we do with it?</strong></p>
<p>This where the fun begins. We read the session cookie <em>on every request</em>,
and if we find one then we are going to parse it into a session object or instance
and store it in the <code class="language-text">req</code> object, this fits super fine because the parsed, hydrated session
object only applies on a particular request, the next request might belong to another user or even
to a non authenticated user.</p>
<p>Why do we need to parse it? Basically, we will store it as string in the cookie and when
we read the cookie we are going to parse it back to an object, this is a very simple approach, more
commonly you will store the session as a base64 encoded json object to save space and later you will
parse it into an instance of a class so that you can cache some results and provide certain useful methods
to the rest of the app. In our case we simply reuse the <code class="language-text">TokenSet</code> class with useful methods that
the <a href="https://github.com/panva/node-openid-client">openid-client</a> lib provides.</p>
<p>This is a nice illustration of the flow you will soon see in code:</p>
<style>
.flow2 img {
 max-width: 500px;
}

.flow2 p {
text-align: center;

}
</style>
<div class="flow2">
<p><img src="/5ddf56d912b9307f2c486659a827916a/flow2.svg" alt="Session Middleware flow diagram"></p>
</div>
<p>Enough talk, let’s code:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">session</span><span class="token punctuation">(</span>
  req<span class="token operator">:</span> Request<span class="token punctuation">,</span>
  res<span class="token operator">:</span> Response<span class="token punctuation">,</span>
  next<span class="token operator">:</span> NextFunction
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sessionCookie <span class="token operator">=</span> <span class="token function">getSessionCookie</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// If there is no session cookie it means there is no</span>
  <span class="token comment">// authenticated user associated with this request,</span>
  <span class="token comment">// no further work needed.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sessionCookie<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> client <span class="token operator">=</span> req<span class="token punctuation">.</span>app<span class="token punctuation">.</span>authClient<span class="token punctuation">;</span>
  <span class="token comment">// Parse the cookie into a TokenSet instance</span>
  <span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token function">deserialize</span><span class="token punctuation">(</span>sessionCookie<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Refresh the tokens if necessary</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>session<span class="token punctuation">.</span>tokenSet<span class="token punctuation">.</span><span class="token function">expired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> refreshedTokenSet <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span>
        session<span class="token punctuation">.</span>tokenSet
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      session<span class="token punctuation">.</span>tokenSet <span class="token operator">=</span> refreshedTokenSet<span class="token punctuation">;</span>
      <span class="token comment">// set the cookie with the refreshed tokens</span>
      <span class="token function">setSessionCookie</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token function">serialize</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// this can throw when the refresh</span>
      <span class="token comment">// token has expired,</span>
      <span class="token comment">// logout completely when that happens</span>
      <span class="token function">clearSessionCookie</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// We also verify that the tokens inside the cookie are valid</span>
  <span class="token comment">// with public keys mechanisms covered by the JWT spec.</span>
  <span class="token comment">// This is unfortunately a private method of the lib, but basically</span>
  <span class="token comment">// it grabs the id_token and decodes it as JWT with a public key</span>
  <span class="token comment">// that we got as part as the discovery process, if this succeeds it means</span>
  <span class="token comment">// that the token inside the cookie is a token that has been crated by our</span>
  <span class="token comment">// identity provided and thus it is secure and fine and we can trust it.</span>
  <span class="token keyword">const</span> validate <span class="token operator">=</span> client<span class="token punctuation">.</span>validateIdToken <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">validate</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> session<span class="token punctuation">.</span>tokenSet<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"bad token signature found in auth cookie"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Bad Token in Auth Cookie!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// After all that work the only thing remaining is</span>
  <span class="token comment">// to store the valid session object into req.session</span>
  <span class="token comment">// for the rest of the app to use.</span>
  req<span class="token punctuation">.</span>session <span class="token operator">=</span> session<span class="token punctuation">;</span>

  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>What might the rest of the app do with <code class="language-text">req.session</code>?
Just to give some ideas:</p>
<ul>
<li>check if there is a user logged in (i.e. only allowing to view certain content to authenticated users)</li>
<li>display information about the logged in user, such as menu icons etc</li>
<li>fetch data associated with a user to a database or another service</li>
<li>check user permissions and create a more complex allow list of routes</li>
<li>many many more things.</li>
</ul>
<p>The main point of this middleware (which is inspired by prior work such as
<a href="https://www.npmjs.com/package/express-session">express-session</a> and <a href="http://www.passportjs.org/">Passport.js</a>) is to abstract all the logic of
parsing the session cookie, refreshing if necessary and hydrating the <code class="language-text">req.session</code> object
in a single place, the rest of the app can rely on that being there and that nothing else will
need to be done there.</p>
<p>We also have a nice example middleware that prevents non authenticated users to access
certain routes:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">requireAuth</span><span class="token punctuation">(</span>
  req<span class="token operator">:</span> Request<span class="token punctuation">,</span>
  res<span class="token operator">:</span> Response<span class="token punctuation">,</span>
  next<span class="token operator">:</span> NextFunction
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> session <span class="token operator">=</span> req<span class="token punctuation">.</span>session<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"unauthenticated"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Of course this will only work if the <code class="language-text">session</code> middleware runs first in the middleware chain
and this runs later, that is why it is important that your session middleware to be run as early as possible,
at least before your routes definitions.</p>
<h3 id="step-5-log-out"><a href="#step-5-log-out" aria-label="step 5 log out permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 5: Log Out</h3>
<p>In here you have two options:</p>
<ul>
<li>Logging out of just your app</li>
<li>Logging out entirely out of the identity provider</li>
</ul>
<p>We are going to use the first approach:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/auth/logout"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> client <span class="token operator">=</span> req<span class="token punctuation">.</span>app<span class="token punctuation">.</span>authClient<span class="token punctuation">;</span>
  <span class="token keyword">const</span> tokenSet <span class="token operator">=</span> req<span class="token punctuation">.</span>session<span class="token operator">?.</span>tokenSet<span class="token punctuation">;</span>

  <span class="token comment">// Make sure the access token we got from the identity provider</span>
  <span class="token comment">// gets revoked, this is for security reasons</span>
  <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">revoke</span><span class="token punctuation">(</span>tokenSet<span class="token operator">!</span><span class="token punctuation">.</span>access_token<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Clean up session cookies</span>
  <span class="token function">clearSessionCookie</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>

  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h3 id="step-6-putting-it-all-together"><a href="#step-6-putting-it-all-together" aria-label="step 6 putting it all together permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 6: Putting it all together</h3>
<p>With a little bit of express experience we can encapsulate all the previous logic
into nice middlewares and leave the rest of the app to deal with domain / business logic.</p>
<p>We put all the authentication related code in the <code class="language-text">auth</code> directory, and the high level api is
made up of middlewares. You can use middleware factories for more complex use cases (functions that accept
options and return middlewares, and yes, the router <em>is</em> a middleware).</p>
<h3 id="step-7-single-sign-on"><a href="#step-7-single-sign-on" aria-label="step 7 single sign on permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 7: Single Sign On</h3>
<p>Single Sign On (SSO) means that if you are already authenticated with one app using the same
OpenId Identity Provider then you will be almost automatically authenticated we other apps.</p>
<p>We have set a nice example in the repo, check instructions to see it in action <a href="https://github.com/franleplant/sso-with-openid">here</a>.</p>
<p>How does it work?</p>
<ul>
<li>the Session cookie is completely independent in each app (see the domain note on the repo’s README).</li>
<li>If you already logged in with app1 then when you try to login with app2 then you won’t need to introduce your credentials and the OAuth flow will happen without you (the user) needing to do anything, that is why I say it is almost automatic.</li>
</ul>
<h2 id="bonus-the-complete-sequence-diagram-of-oidc-authentication"><a href="#bonus-the-complete-sequence-diagram-of-oidc-authentication" aria-label="bonus the complete sequence diagram of oidc authentication permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bonus: the complete sequence diagram of oidc authentication</h2>
<p>Most of the time you will see this sequence diagram simplified, but I wanted
to show you in full details all the steps and http redirects there are inside this
transaction, most of the time you won’t need to worry about these but I think
it is a nice exercise to have it detailed fully like this:</p>
<p><img src="/be05b5e82862d20b8aa6cde5ca810ca4/flow3.svg" alt="OAuth OpenId authorization code flow sequence diagram"></p>
<h2 id="bonus-what-are-the-access-refresh-and-id-tokens"><a href="#bonus-what-are-the-access-refresh-and-id-tokens" aria-label="bonus what are the access refresh and id tokens permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bonus: what are the access, refresh and id tokens?</h2>
<p>Each identity provider might use them differently but these are
some of the core ideas behind each of them</p>
<ul>
<li><em>access token</em>: an opaque value with a short expiration that the identity server uses to identify a user (think of it as a portable session id)</li>
<li><em>refresh token</em>: another opaque value with a longer expiration that it is used to refresh the access token and the id token. Long lived sessions are typically handled by this two step process to give more control to identity providers.</li>
<li><em>id token</em>: this is what OpendId Connect adds, this is a self contained jwt that contains claims (attributes) about the identity of the currently logged in user. This is what makes sense the most to use inside your own system to check the identity of the user. You can cryptographically verify its validity and it will contain minimal information such as the <code class="language-text">sub</code> id (the subject id or the user id), the email, the names, etc.</li>
</ul>
<h2 id="exercise-1"><a href="#exercise-1" aria-label="exercise 1 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Exercise 1</h2>
<p>How would you implement a “back to” functionality?</p>
<p>Let’s say that you originally tried to access <code class="language-text">/private/route/1</code> but you weren’t authenticated yet
so we redirected you to <code class="language-text">/auth/login</code>.
After going through all the auth flow we would like for the app to redirect automatically back
to <code class="language-text">/private/route/1</code>.</p>
<details>
  <summary>Show me the answer</summary>
<p>See answer <a href="https://github.com/franleplant/sso-with-openid/blob/master/src/auth/routes.ts#L31-L43">here</a>. A couple of notes:</p>
<ul>
<li>you basically store a <code class="language-text">backTo</code> param in the state and in the cookie</li>
<li>you can store more stuff in the <code class="language-text">state</code></li>
<li>we need it also in the cookie to prevent XSRF.</li>
<li>Check the <a href="https://tools.ietf.org/html/draft-bradley-oauth-jwt-encoded-state-00">IETF standard</a> and read more <a href="https://auth0.com/docs/protocols/state-parameters">here</a></li>
</ul>
</details>
<h2 id="closing"><a href="#closing" aria-label="closing permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Closing</h2>
<p>Did you like the content? Consider sharing it in your social circle and subscribing
to receive awesome exclusive content right into your email box.</p></section><style data-emotion-css="10ckprm">.css-10ckprm{text-align:center;border:2px solid #FF00FF;border-radius:5px;margin-bottom:18px;padding:5px;}.css-10ckprm form{margin:0;}.css-10ckprm form > div{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}.css-10ckprm form > div > *{margin:0px 4px;}</style><div class="css-10ckprm eosl09g0"><h3>Subscribe to our mailing list!</h3><h4>Get exclusive content, offers and become a friend!</h4><div id="mc_embed_signup"><form action="https://nosleepjavascript.us2.list-manage.com/subscribe/post?u=c388336980630bd93629517cb&amp;id=53ee07001f" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate=""><div id="mc_embed_signup_scroll"><div class="mc-field-group" style="display:inline-block"><label for="mce-EMAIL" style="display:none">email <span style="color:red">*</span> </label><input type="email" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="email address"/></div><div id="mce-responses" style="position:absolute"><div class="response" id="mce-error-response" style="display:none"></div><div class="response" id="mce-success-response" style="display:none"></div></div><div style="position:absolute;left:-5000px" aria-hidden="true"><input type="text" name="b_c388336980630bd93629517cb_53ee07001f" tabindex="-1"/></div><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"/></div></form></div></div><style data-emotion-css="97rap9">.css-97rap9{margin-bottom:1.625rem;}</style><hr class="css-97rap9"/><footer><style data-emotion-css="k6ta3s">.css-k6ta3s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:4.0625rem;}</style><div class="css-k6ta3s e1rgz5o20"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;margin-right:0.8125rem;margin-bottom:0;min-width:50px;border-radius:100%"><div aria-hidden="true" style="width:100%;padding-bottom:87.99999999999999%"></div><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwr+/fsHJL9++dLT1RkbFZGWkrxy+fL379/BpZABAxr/79+/QPLyxYsWpiYqSkoaykou9naLFsz/jw2ga/7z5w+QbKitsVSVKorwWFafHuFgLCYscujgAbjRBGzesnHd9vasnwfm/D+1fH1bgaCgwKSJE+BG49QM8diL508nF8Yc6i1cVZ++tafETlf19GEibIZo/vLp/Zn5bfeWd77YNOX8guYj0+v+f/sIkcanGa5i68SqVeXxFxe2nJxVfW7LEpAwqrXYNUMUndm9dk9P/obOgukFYZeO7iFKM9DZf8GhcmDvriw/y3xvgy0tSetn9xw4fPT6tes/f/4kYDMwSJ88eRIREZ7oqDkhw7cxL8nTzc3dw9va2nbPnr3IwcaAFlTv3r3r6OgMj4i0srZ0d7KzMDU2s7T18w/MzMzOyMxdtnwlclJjQNYJJNva2wMCgyOjon39fH18/ULDwvMLivLyi2Jj41NSUpOSU65dvw63nAE5bew9cNDR1T0yJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu7cjaIZYu3nz58mtdaWpUYFBwd4eXkFBASGhYUBrQqPjPLy9k5ISEhLS4uKilm/fj0WzauWLT47p+760uakYA9zKytPT4/wcKDfo9zc3aNjolNT0zIyMkNDIzZs2IjQDKFu374NNHtBR8XVlT0N6WGW1jZBQUH+AQGWFibOjg5ABwNRUlJqSEjY9es3EJohaX3OnDlOri7BQItiYuPi4qNjgFRCdkrC6o789MTY0PDI8LBwX1//iooqeNAiNE+cNFFPT9fJ2dHZ1dXF1c3MzMTCwiIiNDgzJc7PP8DX19fb29vOzn7jxo3I8QwAkD8cNPji0p0AAAAASUVORK5CYII=" alt="franleplant" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,
/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,
/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w" sizes="(max-width: 620px) 100vw, 620px" /><img loading="lazy" sizes="(max-width: 620px) 100vw, 620px" srcset="/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,
/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,
/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w" src="/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png" alt="franleplant" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><style data-emotion-css="1uk1gs8">.css-1uk1gs8{margin:0;}</style><p class="css-1uk1gs8">Written by <strong><a href="https://twitter.com/franleplant">franleplant</a></strong>: <!-- -->Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.<!-- --> <a href="https://github.com/franleplant" target="_blank" rel="noopener noreferrer">Github</a></p></div><style data-emotion-css="1cckvuk">.css-1cckvuk{margin-top:-20px;margin-bottom:20px;}</style><div class="css-1cckvuk"><div><a href="https://www.buymeacoffee.com/Kp6R5Zr"><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a coffee&amp;emoji=&amp;slug=Kp6R5Zr&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Cookie&amp;outline_colour=000000&amp;coffee_colour=ffffff" alt="buy me coffee"/></a></div><div><a href="https://www.patreon.com/bePatron?u=44509257" data-patreon-widget-type="become-patron-button">Become a Patron!</a></div></div></footer></article><style data-emotion-css="e42043">.css-e42043{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;list-style:none;padding:0;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}@media (min-width:800px){.css-e42043{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}</style><nav class="css-e42043 e5iwqvu0"><style data-emotion-css="d6w1ze">.css-d6w1ze{border:1px solid #FF00FF;border-radius:2px;padding:8px 16px;margin:2px;}@media (min-width:800px){.css-d6w1ze{width:49%;}}</style><div class="css-d6w1ze e5iwqvu1"><a rel="prev" href="/express-route-namespace/">← <!-- -->How to create route namespaces with Express</a></div><div class="css-d6w1ze e5iwqvu1"><a rel="next" href="/why-i-love-jest/">Jest makes unit testing fun again<!-- --> →</a></div></nav><style data-emotion-css="1eyoxlr">.css-1eyoxlr{margin-top:20px;margin-bottom:20px;color:#ccc;}</style><div class="css-1eyoxlr e14frcs80">Using OpenId Connect to implement Single Sign On across multiple applications. How to implement persistent cookie session with Express.js,  Node.js and Typescript OpenId Connect as an authentication provider in a Micro Service Architecture. OpenId Connect Identity provider for a Single Sign On experience across multiple apps. Using JWT as self contained sessions in a microservice architecture. how to use an OpenId auth provider in a microservice architecture? how OpenId connect works? how to integrate OpenId auth with browser authentications. from zero to hero OAuth / OpenId. using openid connect to integrate authn with microfrontend apps. implementing SSO via openId. understanding OpenId Connect by building an app. Implementing SSO with Google OpenId Connect.</div></main><footer>© <!-- -->2021<!-- -->, nosleepjavascript.com</footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-154632381-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/openid-oauth-authentication-for-nodejs/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-f33cc994945b2249d5ee.js"],"app":["/app-b1e139d0da4ec73b7381.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-b0556ce5127c1a3e2490.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-3241c106c435f58ca4bd.js"],"component---src-pages-about-tsx":["/component---src-pages-about-tsx-ab533fcf78dbe17aad64.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-600ba704604721ac4f4a.js"],"component---src-templates-blog-post-tsx":["/component---src-templates-blog-post-tsx-13d8f6300d73de8b3055.js"]};/*]]>*/</script><script src="/polyfill-f33cc994945b2249d5ee.js" nomodule=""></script><script src="/component---src-templates-blog-post-tsx-13d8f6300d73de8b3055.js" async=""></script><script src="/07df214fa9a6bfa95f2aa0c4b93680dbfb4b3ad9-8b678077d6dbe8f052d8.js" async=""></script><script src="/201ad6c3f2c882b9d9cf079e4b183f9823aadb3d-8b06601edeb74dd5b1c5.js" async=""></script><script src="/app-b1e139d0da4ec73b7381.js" async=""></script><script src="/framework-741ade27086b2708e961.js" async=""></script><script src="/styles-55e82d6ff5158c00b714.js" async=""></script><script src="/webpack-runtime-04fbafd859ab94f12b33.js" async=""></script></body></html>